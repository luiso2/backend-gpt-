# BEGIN LSCACHE
# END LSCACHE
# BEGIN NON_LSCACHE
# END NON_LSCACHE

# Wordfence WAF
<IfModule LiteSpeed>
php_value auto_prepend_file '/home/u517309027/domains/mercatop.com/public_html/wordfence-waf.php'
</IfModule>
<IfModule lsapi_module>
php_value auto_prepend_file '/home/u517309027/domains/mercatop.com/public_html/wordfence-waf.php'
</IfModule>
# END Wordfence WAF

<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# Proteger archivos sensibles
RewriteRule ^wp-config\.php$ - [F,L]
RewriteRule ^\.env$ - [F,L]
RewriteRule ^\.git - [F,L]

# IMPORTANTE: Permitir acceso a WordPress y sus recursos PRIMERO
# Esto evita que las reglas de Next.js interfieran con WordPress
RewriteCond %{REQUEST_URI} ^/wp-admin [OR]
RewriteCond %{REQUEST_URI} ^/wp-login\.php [OR]
RewriteCond %{REQUEST_URI} ^/wp-json [OR]
RewriteCond %{REQUEST_URI} ^/wp-content [OR]
RewriteCond %{REQUEST_URI} ^/wp-includes [OR]
RewriteCond %{REQUEST_URI} ^/wp-cron\.php [OR]
RewriteCond %{REQUEST_URI} ^/xmlrpc\.php [OR]
RewriteCond %{REQUEST_URI} ^/wp-.*.php [OR]
RewriteCond %{REQUEST_URI} ^/index\.php$ [OR]
RewriteCond %{REQUEST_URI} ^/wordfence
RewriteRule ^ - [L]

# Si el archivo o directorio existe físicamente, servirlo
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Redirigir todo lo demás a la carpeta de Next.js
# NOTA: Cambia 'mercatop-v2' por el nombre real de tu carpeta
RewriteRule ^(.*)$ /mercatop-v2/$1 [L]
</IfModule>

# Configuración de seguridad adicional
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Compresión Gzip
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE font/truetype
    AddOutputFilterByType DEFLATE font/opentype
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# Cache para assets estáticos
<IfModule mod_expires.c>
    ExpiresActive On
    
    # Imágenes
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresByType image/ico "access plus 1 year"
    
    # Fuentes
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    
    # CSS y JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    
    # Otros
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    
    # Default
    ExpiresDefault "access plus 2 days"
</IfModule>

# Nota: Las reglas de WordPress fueron removidas porque ya están siendo manejadas
# por las reglas anteriores. Si necesitas reglas específicas de WordPress,
# agrégalas DESPUÉS de las reglas de Next.js para evitar conflictos.