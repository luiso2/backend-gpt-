# BEGIN LSCACHE
# END LSCACHE
# BEGIN NON_LSCACHE
# END NON_LSCACHE

# Wordfence WAF
<IfModule LiteSpeed>
php_value auto_prepend_file '/home/u517309027/domains/mercatop.com/public_html/wordfence-waf.php'
</IfModule>
<IfModule lsapi_module>
php_value auto_prepend_file '/home/u517309027/domains/mercatop.com/public_html/wordfence-waf.php'
</IfModule>
# END Wordfence WAF

# INICIO Configuración Next.js + WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

# 1. Proteger archivos sensibles
RewriteRule ^wp-config\.php$ - [F,L]
RewriteRule ^\.env$ - [F,L]

# 2. WordPress - Permitir acceso a archivos y carpetas de WP
RewriteCond %{REQUEST_URI} ^/(wp-admin|wp-includes|wp-content)/ [OR]
RewriteCond %{REQUEST_URI} ^/wp-([a-z\-]+)\.php$ [OR]
RewriteCond %{REQUEST_URI} ^/index\.php$ [OR]
RewriteCond %{REQUEST_URI} ^/wp-json(/.*)?$ [OR]
RewriteCond %{REQUEST_URI} ^/\?rest_route= [OR]
RewriteCond %{REQUEST_URI} ^/wordfence
RewriteRule ^(.*)$ - [L]

# 3. Si existe el archivo o carpeta, servirlo directamente
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(.*)$ - [L]

# 4. WordPress REST API - Regla específica
RewriteRule ^wp-json/(.*?)$ /index.php?rest_route=/$1 [L]

# 5. Todo lo demás va a Next.js
RewriteCond %{REQUEST_URI} !^/mercatop-v2/
RewriteRule ^(.*)$ /mercatop-v2/$1 [L]
</IfModule>
# FIN Configuración Next.js + WordPress

# WordPress básico (solo si es necesario para permalinks)
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} /wp-
RewriteRule . /index.php [L]
</IfModule>